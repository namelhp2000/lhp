@using RoadFlow.Utility;
@using RoadFlow.Business;
@using Microsoft.AspNetCore.Http;
@{
	var Request = (HttpRequest)ViewData["request"];
	string instanceId = Request.Querys("instanceid");
	string taskId = Request.Querys("taskid");
	string stepId = Request.Querys("stepid");
	string flowId = Request.Querys("flowid");
	string display = Request.Querys("display");
	bool showArchive = "1".Equals(Request.Querys("showarchive"));
	string fieldStatusJSON = string.Empty;
	string formData = showArchive ? new RoadFlow.Business.FlowArchive().GetArchiveData(Request.Querys("archiveid").ToGuid()) : new RoadFlow.Business.Form().GetFormData("dba78397-b5df-4145-87af-cb8b5d0655d7", "TryTest", "ID", instanceId, stepId, flowId, "[]", out fieldStatusJSON);
}
<script type="text/javascript" src="~/RoadFlowResources/scripts/flowRun/form.js"></script>
<script type="text/javascript">
	var formDataJSON = @Html.Raw(formData.IsNullOrWhiteSpace() ? "[]" : formData);
	var fieldStatusJSON = @Html.Raw(fieldStatusJSON.IsNullOrWhiteSpace() ? "[]" : fieldStatusJSON);
	var defaultValuesJSON = @Html.Raw(new RoadFlow.Business.Form().GetDefaultValuesJSON("[]", fieldStatusJSON));
	$(window).load(function () {
		formLoad.load(formDataJSON, fieldStatusJSON, "TryTest", "@display", defaultValuesJSON);
	});
</script>
<link href="~/RoadFlowResources/scripts/flowRun/common.css" rel="stylesheet" />
<input type="hidden" name="form_dbconnid" id="form_dbconnid" value="dba78397-b5df-4145-87af-cb8b5d0655d7"/>
<input type="hidden" name="form_dbtable" id="form_dbtable" value="TryTest"/>
<input type="hidden" name="form_dbtableprimarykey" id="form_dbtableprimarykey" value="ID"/>
<input type="hidden" name="form_dbtabletitle" id="form_dbtabletitle" value="s_name"/>
<input type="hidden" name="form_instanceid" id="form_instanceid" value="@instanceId"/>
<textarea style="display:none;" name="form_fieldstatus" id="form_fieldstatus">@Html.Raw(fieldStatusJSON.IsNullOrWhiteSpace() ? "[]" : fieldStatusJSON)</textarea>
<textarea style="display:none;" name="form_dataformatjson" id="form_dataformatjson">[]</textarea>
<p>&nbsp;&nbsp;&nbsp; 姓名：<input data-isflow="1" data-type="text" data-valuetype="" id="TRYTEST-S_NAME" style="" type="text" value="" class="mytext" name="TRYTEST-S_NAME"></p>

<p><table data-isflowsubtable="1" id="SUBTABLE_TRYTESTSUB-ID-ID-ID">
	<thead>
		<tr>
			<th>s_name</th>
			<th>s_address</th>
			<th>s_sum</th>
			<th width="120px" style="text-align:left;">
				<input type="hidden" name="SUBTABLE_id" value="TRYTESTSUB-ID-ID-ID"/>
				<input type="hidden" name="SUBTABLE_TRYTESTSUB-ID-ID-ID_secondtable" value="TryTestsub"/>
				<input type="hidden" name="SUBTABLE_TRYTESTSUB-ID-ID-ID_primarytablefiled" value="ID"/>
				<input type="hidden" name="SUBTABLE_TRYTESTSUB-ID-ID-ID_secondtableprimarykey" value="ID"/>
				<input type="hidden" name="SUBTABLE_TRYTESTSUB-ID-ID-ID_secondtablerelationfield" value="ID"/>
				<input type="button" value="添加" class="mybutton" onclick="formLoad.subtableAddRow('SUBTABLE_TRYTESTSUB-ID-ID-ID', $('#SUBTABLE_TRYTESTSUB-ID-ID-ID tbody tr:first'), true);"/>
			</th>
		</tr>
	</thead>
	<tbody>
		@{
		System.Data.DataTable subtableMapList_TryTestsub_ID_ID_ID = new RoadFlow.Business.DbConnection().GetDataTable(new RoadFlow.Business.DbConnection().Get("dba78397-b5df-4145-87af-cb8b5d0655d7".ToGuid()), "TryTestsub", "ID", instanceId, "");
		if(null == subtableMapList_TryTestsub_ID_ID_ID || subtableMapList_TryTestsub_ID_ID_ID.Rows.Count == 0)
		{
			subtableMapList_TryTestsub_ID_ID_ID = new System.Data.DataTable();
			subtableMapList_TryTestsub_ID_ID_ID.Rows.Add(subtableMapList_TryTestsub_ID_ID_ID.NewRow());
		}
		foreach(System.Data.DataRow dr in subtableMapList_TryTestsub_ID_ID_ID.Rows)
		{
			Object rowIndexObj = subtableMapList_TryTestsub_ID_ID_ID.Columns.Contains("ID") ? dr["ID"] : null;
			string rowIndexStr = null == rowIndexObj ? Guid.NewGuid().ToString() : rowIndexObj.ToString();
			string value_s_name = subtableMapList_TryTestsub_ID_ID_ID.Columns.Contains("s_name") ? dr["s_name"].ToString() : string.Empty;
			string value_s_address = subtableMapList_TryTestsub_ID_ID_ID.Columns.Contains("s_address") ? dr["s_address"].ToString() : string.Empty;
			string value_s_sum = subtableMapList_TryTestsub_ID_ID_ID.Columns.Contains("s_sum") ? dr["s_sum"].ToString() : string.Empty;
		<tr>
			<td style="text-align:left;"><input type="text" value="@value_s_name" data-isflow="1" data-issubtable="1" data-type="text" data-table="TryTestsub" data-field="s_name" name="SUBTABLE_TRYTESTSUB-ID-ID-ID_s_name_@(rowIndexStr)" id="SUBTABLE_TRYTESTSUB-ID-ID-ID_s_name_@(rowIndexStr)" class="mytext"/></td>
			<td style="text-align:left;"><input type="text" value="@value_s_address" data-isflow="1" data-issubtable="1" data-type="text" data-table="TryTestsub" data-field="s_address" name="SUBTABLE_TRYTESTSUB-ID-ID-ID_s_address_@(rowIndexStr)" id="SUBTABLE_TRYTESTSUB-ID-ID-ID_s_address_@(rowIndexStr)" class="mytext"/></td>
			<td style="text-align:left;"><textarea onchange="fun_2A080D9C7C9D4BED4BB3B8EF39688EE5(this);" data-validatetype="int" data-isflow="1" data-issubtable="1" data-type="textarea" data-table="TryTestsub" data-field="s_sum" name="SUBTABLE_TRYTESTSUB-ID-ID-ID_s_sum_@(rowIndexStr)" id="SUBTABLE_TRYTESTSUB-ID-ID-ID_s_sum_@(rowIndexStr)" class="mytextarea">@value_s_sum</textarea></td>
			<td><input type="hidden" name="SUBTABLE_TRYTESTSUB-ID-ID-ID_rowindex" value="@rowIndexStr"/><input type="button" value="插入" class="mybutton" onclick="formLoad.subtableAddRow('SUBTABLE_TRYTESTSUB-ID-ID-ID',$(this).parent().parent(), false);" style="margin-right:3px;"/><input type="button" class="mybutton" value="删除" onclick="formLoad.subtableDelRow($(this).parent().parent());"/></td>
		</tr>
		}
		}
	</tbody>
	<tfoot>
		<tr>
			<td></td>
			<td></td>
			<td data-table="SUBTABLE_TRYTESTSUB-ID-ID-ID" data-field="s_sum" style="text-align:left;"><label id="SUM_SUBTABLE_TRYTESTSUB-ID-ID-ID_s_sum"></label></td>
			<td></td>
		</tr>
	</tfoot>
</table>
<script type="text/javascript">
	function fun_2A080D9C7C9D4BED4BB3B8EF39688EE5(srcElement)
	{
		formLoad.subTableSum("SUBTABLE_TRYTESTSUB-ID-ID-ID", "s_sum");
	}
</script>
</p>
