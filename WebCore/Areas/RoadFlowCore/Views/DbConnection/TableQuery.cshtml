@{
    ViewBag.Title = "TableQuery";
}

<style type="text/css">
    .sqltextarea {
        width: 100%;
        height: 200px;
        vertical-align: top;
        padding: 3px;
        font-family: Verdana;
        font-size: 14px;
    }
</style>
<form method="post" onsubmit="return new RoadUI.Validate().validateForm(this);">
    @Html.AntiForgeryToken()
    <div style="margin:8px auto 0 auto; width:98%;">
        <div style="margin:6px 0;">SQL:</div>
        <div>
            <textarea id="sqltext" name="sqltext" class="sqltextarea">@ViewBag.sqltext</textarea>
        </div>
        <div style="margin:6px 0; text-align:center;">
            <input type="button" class="mybutton"  value=" 执行SQL " onclick="save(this);" />
            <input type="button" class="mybutton" value=" 清空SQL " onclick="$('#sqltext').val('');" style="margin-left:8px;" />
            <input type="button" class="mybutton" value=" 返回前页 " onclick="window.location='Table@(ViewBag.Query)'" style="margin-left:8px;" />
        </div>

        <div style="margin:6px 0;" id="resultdiv">
            <div style="margin:6px 0;" id="counts">执行结果@(Html.Raw(ViewBag.LiteralResultCount)):</div>
            <div id="tablediv" style="overflow:auto;">
                @Html.Raw(ViewBag.LiteralResult)
            </div>
        </div>
    </div>
    <br /><br />
</form>
<script type="text/javascript">
    $(function () {
        $("#tablediv").width($(window).width - 100);
      
    });



     //返回到列表中
    function save(but) {
        var f = document.forms[0];
        if (new RoadUI.Validate().validateForm(f)) {
            //获取form对应的值
            var o = RoadUI.Core.serializeForm($(f));
           
            //开启disable，才能取值
            $(but).prop("disabled", true);
            $.ajax({
                url: "TableQuerySql"+"@Html.Raw(ViewBag.Query)",
                data: o, type: "post", dataType: "json", success: function (json) {
                  
                    var ss = json.sqltext;

                    $("#sqltext").val(json.sqltext);
                    $("#tablediv").html(json.LiteralResult);
                    var s1 = "执行结果" + json.LiteralResultCount + ":";
                    $("#counts").html(s1);
                      //关闭disable 不能取值
                    $(but).prop("disabled", false);

                }
            });
        }
    }
</script>