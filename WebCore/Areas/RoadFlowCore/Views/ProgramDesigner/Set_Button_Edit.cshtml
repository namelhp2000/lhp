@{
    ViewBag.Title = "List";
    var Set_Buttons = "Set_Button" + Html.Raw(ViewBag.queryString);
}

@model RoadFlow.Model.ProgramButton
<form id="form1" method="post">
    @Html.AntiForgeryToken()
     <div>
        <input type="hidden" name="Id" value="@Model.Id" />
        <input type="hidden" name="ProgramId" value="@Model.ProgramId" />
        <table cellpadding="0" cellspacing="1" border="0" width="99%" class="formtable" style="margin-top:10px;">
            <tr>
                <th style="width: 80px;">选择按钮：</th>
                <td>
                    <select class="myselect" style="min-width:135px;" id="ButtonId" name="ButtonId" onchange="buttonChange(this.value);">
                        <option value=""></option>
                        @Html.Raw(ViewBag.buttonOptions)
                    </select>
                </td>
            </tr>
            <tr>
                <th style="width: 80px;">按钮名称：</th>
                <td><input type="text" validate="empty" class="mytext" name="ButtonName" id="ButtonName" value="@Model.ButtonName" /></td>
            </tr>
            <tr>
                <th style="width: 80px;">执行脚本：</th>
                <td>
                    <textarea class="mytextarea" validate="empty" style="width: 80%; height: 60px;" id="ClientScript" name="ClientScript">@Html.Raw(Model.ClientScript)</textarea>
                </td>
            </tr>
            <tr>
                <th style="width: 80px;">图标：</th>
                <td>
                    <input type="text" class="myico" name="Ico" value="@Model.Ico" id="Ico" />
                </td>
            </tr>
            <tr>
                <th style="width: 80px;">按钮类型：</th>
                <td>
                    <select class="myselect" id="ShowType" name="ShowType">
                        <option name="ShowType" selected="selected" value="1" >普通按钮</option>
                        <option name="ShowType" value="0">工具栏按钮</option>
                        <option name="ShowType" value="2">列表按键</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th style="width: 80px;">权限控制：</th>
                <td>
                    <select class="myselect" id="IsValidateShow" name="IsValidateShow">
                        <option name="IsValidateShow" value="0">不控制</option>
                        <option name="IsValidateShow" value="1">控制</option>

                    </select> *如果不控制则不需要授权,每个人都能操作此按钮
                </td>
            </tr>
            <tr>
                <th style="width: 80px;">显示顺序：</th>
                <td><input type="text" class="mytext" id="Sort" name="Sort" value="@Model.Sort" /></td>
            </tr>
        </table>
    </div>
    <div class="buttondiv">
        <input type="button" value=" 保 存 " class="mybutton" onclick="save(this);" />
        <input type="button" class="mybutton" onclick="window.location = '@Set_Buttons';" value=" 返 回 " />
    </div>
</form>
<script type="text/javascript">
     $(function () {

         $("[name='ShowType'][value='" + @Model.ShowType + "']").prop("selected", "selected");
         $("[name='IsValidateShow'][value='" + @Model.IsValidateShow + "']").prop("selected", "selected");
          
            
        });
    function save(but) {
        var f = document.forms[0];
        if (new RoadUI.Validate().validateForm(f)) {
            var o = RoadUI.Core.serializeForm($(f));
            $(but).prop("disabled", true);
            $.ajax({
                url: "SaveSet_Button"+"@Html.Raw(ViewBag.queryString)", data: o, type: "post", success: function (text) {
                    alert(text);
                    $(but).prop("disabled", false);
                    if (text.indexOf('成功') >= 0) {
                        window.location = "Set_Button"+"@Html.Raw(ViewBag.queryString)";
                    }
                }
            });
        }
    }
    function buttonChange(value) {
        buttonJson =@Html.Raw(ViewBag.buttonJson);
        for (i = 0; i < buttonJson.length; i++) {
            if (value.toUpperCase() == buttonJson[i]["Id"].toUpperCase()) {
                $("#ButtonName").val(buttonJson[i]["Name"]);
                $("#ClientScript").val(buttonJson[i]["Events"]);
                $("#Ico").val(buttonJson[i]["Ico"]);
                break;
            }
        }
    }
</script>



